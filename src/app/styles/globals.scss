// Juice Finder - Styles globaux
@import 'variables';
@import 'mixins';
@import 'theme';
@import "tailwindcss/theme";
@import "tailwindcss/preflight";
@import "tailwindcss/utilities";

// ===== Variables CSS globales =====
:root {
  --color-primary: #{$color-primary};
  --color-secondary: #{$color-secondary};
  --color-background-light: #{$color-background-light};
  --color-background-dark: #{$color-background-dark};
  --color-background: #{$color-background};
  --color-accent: #{$color-accent};
  --color-text: #{$color-text};
  --color-success: #{$color-success};
  --color-info: #{$color-info};
  
  --font-primary: #{$font-family-primary};
  --font-secondary: #{$font-family-secondary};
  
  --background: #{$color-background};
  --foreground: #{$color-text};
}

// ===== Styles de base =====
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  scroll-behavior: smooth;
  font-size: 16px;
}

body {
  background: var(--color-background-dark);
  color: var(--color-text);
  font-family: $font-family-primary;
  font-weight: $font-weight-normal;
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

// ===== Titres =====
h1, h2, h3, h4, h5, h6 {
  font-family: $font-family-secondary;
  font-weight: $font-weight-semibold;
  color: $color-secondary;
  line-height: 1.2;
  margin-bottom: $spacing-md;
}

h1 {
  font-size: $font-size-4xl;
  
  @include mobile {
    font-size: $font-size-3xl;
  }
}

h2 {
  font-size: $font-size-3xl;
  
  @include mobile {
    font-size: $font-size-2xl;
  }
}

h3 {
  font-size: $font-size-2xl;
  
  @include mobile {
    font-size: $font-size-xl;
  }
}

// ===== Liens =====
a {
  color: $color-primary;
  text-decoration: none;
  transition: color $transition-fast;
  
  &:hover {
    color: lighten($color-primary, 10%);
  }
}

/* Liens et icônes dark mode */
.link-plain { color: var(--color-text); text-decoration: none; transition: color $transition-fast; }
.link-plain:hover { color: lighten($color-primary,15%); }
.link-accent { color: $color-primary; text-decoration: none; font-weight:$font-weight-medium; }
.link-accent:hover { color: lighten($color-primary,10%); text-decoration: underline; }
.icon-light { color: var(--color-text); padding: 3px; }
.icon-muted { color: rgba(255,255,255,0.6); }
.icon-accent { color: $color-primary; }
.action-btn-dark { background:$color-surface-dark-3; color: var(--color-text); border:1px solid $color-surface-outline; border-radius:$border-radius-md; padding:.35rem .6rem; display:inline-flex; align-items:center; justify-content:center; transition:background $transition-fast,color $transition-fast,border-color $transition-fast; }
.action-btn-dark:hover { background:$color-surface-dark-2; border-color:$color-primary; color: var(--color-text); }
.action-btn-dark--call:hover { background:rgba($color-success,0.25); border-color:$color-success; }

// ===== Scrollbar personnalisée =====
* {
  @include custom-scrollbar;
}

// ===== Sélection de texte =====
::selection {
  background-color: rgba($color-primary, 0.2);
  color: $color-text;
}

::-moz-selection {
  background-color: rgba($color-primary, 0.2);
  color: $color-text;
}

// ===== MapLibre popup personnalisation =====
.maplibregl-popup-content {
  padding: $spacing-md;
  border-radius: $border-radius-lg;
  box-shadow: $shadow-lg;
  border: 1px solid $color-gray-200;
  background-color: $color-white;
  
  h3 {
    color: $color-secondary;
    font-size: $font-size-lg;
    margin-bottom: $spacing-sm;
  }
  
  p {
    color: $color-text;
    font-size: $font-size-sm;
    margin-bottom: $spacing-xs;
    
    &:last-child {
      margin-bottom: 0;
    }
  }
}

.maplibregl-popup-close-button {
  font-size: $font-size-xl;
  padding: 0 $spacing-sm;
  color: $color-gray-500;
  transition: all $transition-fast;
  
  &:hover {
    background-color: $color-gray-100;
    color: $color-text;
  }
}

.maplibregl-popup-anchor-top .maplibregl-popup-tip {
  border-bottom-color: $color-white;
}

.maplibregl-popup-anchor-bottom .maplibregl-popup-tip {
  border-top-color: $color-white;
}

.maplibregl-popup-anchor-left .maplibregl-popup-tip {
  border-right-color: $color-white;
}

.maplibregl-popup-anchor-right .maplibregl-popup-tip {
  border-left-color: $color-white;
}

// ===== Classes utilitaires personnalisées =====
.container {
  width: 100%;
  max-width: 1280px;
  margin: 0 auto;
  /* Ne définit plus le padding vertical pour laisser py-* fonctionner */
  padding-left: $spacing-md;
  padding-right: $spacing-md;
  @include responsive($breakpoint-lg) {
    padding-left: $spacing-xl;
    padding-right: $spacing-xl;
  }
}

.btn-primary {
  @include button-primary;
}

.btn-secondary {
  @include button-secondary;
}

.btn-success {
  @include button-success;
}

.card, .card-bordered, .restaurant-card, .update-panel {
  background-color: $color-white;
  color: $color-surface-text;
  cursor: default;
}

.card {
  @include card;
}

.card-bordered {
  @include card-bordered;
}

.input {
  @include input-base;
}

/* Style unifié pour champs de formulaire natifs */
input[type='text'],
input[type='search'],
input[type='email'],
input[type='tel'],
textarea {
  @include input-base;
}

.select {
  @include input-base;
  appearance: none;
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' fill='%236B7280' viewBox='0 0 20 20'><path d='M5.25 7.5l4.5 4.5 4.5-4.5'/></svg>");
  background-repeat: no-repeat;
  background-position: right 0.75rem center;
  background-size: 16px 16px;
  padding-right: 2.5rem; /* espace pour la flèche */
  cursor: pointer;

  &:focus {
    background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' fill='%232853FE' viewBox='0 0 20 20'><path d='M5.25 7.5l4.5 4.5 4.5-4.5'/></svg>");
  }

  option {
    padding: $spacing-sm $spacing-md;
  }
}

/* Safari/iOS corrections */
select {
  -webkit-appearance: none;
}

/* Désactivation du zoom auto sur focus iOS (taille de police >=16px déjà) */
// ===== Animations globales =====
@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

@keyframes bounce {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-10px);
  }
}

.animate-spin {
  animation: spin 1s linear infinite;
}

.animate-pulse {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

.animate-bounce {
  animation: bounce 1s infinite;
}

// ===== États de chargement =====
.loading {
  @include flex-center;
  min-height: 200px;
  color: $color-gray-500;
  
  &::after {
    content: '';
    width: 40px;
    height: 40px;
    border: 4px solid $color-gray-200;
    border-top-color: $color-primary;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
}

// ===== Messages d'erreur =====
.error-message {
  padding: $spacing-md;
  background-color: rgba($color-error, 0.1);
  border: 1px solid $color-error;
  border-radius: $border-radius-md;
  color: $color-error;
  font-size: $font-size-sm;
  @include flex-start;
  gap: $spacing-sm;
}

// ===== Messages de succès =====
.success-message {
  padding: $spacing-md;
  background-color: rgba($color-success, 0.1);
  border: 1px solid $color-success;
  border-radius: $border-radius-md;
  color: darken($color-success, 30%);
  font-size: $font-size-sm;
  @include flex-start;
  gap: $spacing-sm;
}

// ===== Badge =====
.badge {
  display: inline-flex;
  align-items: center;
  padding: $spacing-xs $spacing-sm;
  border-radius: $border-radius-full;
  font-size: $font-size-xs;
  font-weight: $font-weight-medium;
  
  &.badge-primary {
    background-color: rgba($color-primary, 0.1);
    color: $color-primary;
  }
  
  &.badge-success {
    background-color: rgba($color-success, 0.1);
    color: darken($color-success, 30%);
  }
  
  &.badge-info {
    background-color: rgba($color-info, 0.1);
    color: darken($color-info, 30%);
  }
}

// === Utilitaires couleurs & surfaces ===
.bg-app { background-color: var(--background); }
.bg-surface { background-color: $color-white; }

// === Logo & Branding ===
.logo-text {
  font-family: var(--font-owners-wide), var(--font-owners), sans-serif;
  font-weight: 900;
  letter-spacing: -0.02em;
  text-transform: uppercase;
}

.logo-finder {
  font-family: var(--font-owners-wide), var(--font-owners), sans-serif;
  font-weight: 900;
  font-size: $font-size-logo;
  color: $color-primary;
  line-height: 40px;
  padding-top: 3px;

  /* Outline rond (style bubble) ~4px, sans angles pointus */
  -webkit-text-stroke: 10px $color-white; /* on désactive le stroke miteré */
  paint-order: stroke; /* au cas où le moteur le supporte */
}
.bg-surface-alt { background-color: $color-background-light; }
.text-heading { color: var(--color-secondary); }
.text-body { color: var(--color-text); }
.text-muted { color: $color-gray-600; }
.border-default { border: 1px solid $color-gray-200; }
.border-accent { border: 1px solid var(--color-primary); }

// === Badges génériques ===
.badge { @extend .badge; }
.badge-type { @extend .badge; background-color: $color-primary; color: white; }
.badge-green { @extend .badge; background-color: $color-success; color: $color-secondary; }
.badge-blue { @extend .badge; background-color: rgba($color-primary,0.12); color: $color-primary; }

// === Carte Restaurant ===
.restaurant-card { @include card-bordered; padding: $spacing-md; position: relative; cursor: pointer; transition: box-shadow $transition-fast, border-color $transition-fast; }
.restaurant-card:hover { box-shadow: $shadow-md; }
.restaurant-card.is-selected { border-color: var(--color-primary); box-shadow: 0 0 0 2px rgba($color-primary,0.15); }
.restaurant-card__title { color: $color-secondary; font-size: $font-size-lg; font-weight: $font-weight-semibold; margin-bottom: $spacing-xs; }
.restaurant-card__meta { display:flex; flex-wrap:wrap; gap:$spacing-xs; align-items:center; }
.restaurant-card__address { display:flex; gap:$spacing-sm; font-size:$font-size-sm; color:$color-gray-600; }
.restaurant-card__actions { display:flex; gap:$spacing-xs; margin-left:auto; }
.restaurant-card__icon-btn { padding: .4rem; border-radius:$border-radius-md; background:transparent; color:$color-gray-500; display:inline-flex; align-items:center; justify-content:center; transition:background $transition-fast,color $transition-fast; }
.restaurant-card__icon-btn:hover { background:$color-gray-100; color:var(--color-primary); }
.restaurant-card__icon-btn--call:hover { background:rgba($color-success,0.15); color:darken($color-success,25%); }
.restaurant-card__section { margin-top:$spacing-sm; padding-top:$spacing-sm; border-top:1px solid $color-gray-700; }

@media (max-width: 768px) {
  .restaurant-card__icon-btn {
    width: 56px;
    height: 56px;
    font-size: 2rem; /* Augmente la taille de l'icône */
  }
}

// === Search Bar ===
.search-bar { position:relative; width:100%; }
.search-input { @include input-base; padding-left:2.75rem; }
.search-clear { position:absolute; top:50%; right:0.9rem; transform:translateY(-50%); color:$color-gray-400; background:transparent; border:none; cursor:pointer; padding:0; display:inline-flex; transition:color $transition-fast; }
.search-clear:hover { color:$color-gray-600; }
.search-icon { position:absolute; left:0.9rem; top:50%; transform:translateY(-50%); width:1.2rem; height:1.2rem; color:$color-gray-400; }

// === Loader ===
.loader { @include flex-column; align-items:center; justify-content:center; }
.loader__spinner { width:64px; height:64px; position:relative; }
.loader__ring { position:absolute; inset:0; border:4px solid $color-gray-200; border-radius:50%; }
.loader__ring--active { border-color: var(--color-primary); border-top-color: transparent; animation: spin 0.9s linear infinite; }
.loader__text { margin-top:$spacing-sm; font-size:$font-size-sm; color:$color-gray-600; }

// === Update Widget ===
.update-widget { position:fixed; bottom:1.5rem; right:1.5rem; z-index:$z-index-popover; }
.update-panel { @include card-bordered; padding:$spacing-md; width:320px; }
.update-panel__stats { background:rgba($color-success,0.1); border:1px solid $color-success; border-radius:$border-radius-md; padding:$spacing-sm; }
.update-panel__error { background:rgba($color-error,0.1); border:1px solid $color-error; border-radius:$border-radius-md; padding:$spacing-sm; }
.update-panel__info { font-size:$font-size-xs; color:$color-gray-600; margin-top:$spacing-sm; line-height:1.4; }
.update-panel__small-btn { width:100%; padding:.4rem .75rem; font-size:$font-size-xs; border:1px solid $color-gray-300; background:$color-white; border-radius:$border-radius-md; cursor:pointer; display:inline-flex; justify-content:center; align-items:center; gap:.35rem; transition:background $transition-fast,color $transition-fast,border-color $transition-fast; }
.update-panel__small-btn:hover { background:$color-gray-100; }
.update-panel__small-btn--warn { border-color: lighten($color-warning,25%); color: darken($color-warning,10%); }
.update-panel__small-btn--warn:hover { background:rgba($color-warning,0.1); }
.update-panel__small-btn--danger { border-color: lighten($color-error,25%); color: darken($color-error,10%); }
.update-panel__small-btn--danger:hover { background:rgba($color-error,0.1); }

// === Bouton synchroniser principal ===
.btn-sync { @include button-success; width:100%; display:flex; align-items:center; justify-content:center; gap:$spacing-sm; font-weight:$font-weight-medium; }
.btn-sync.is-loading { background:$color-gray-400; cursor:not-allowed; box-shadow:none; }
.btn-sync__spinner { width:20px; height:20px; border:2px solid $color-white; border-top-color:transparent; border-radius:50%; animation: spin 1s linear infinite; }

// ===== Responsive utilities =====
.mobile-only {
  @include desktop {
    display: none !important;
  }
}

.desktop-only {
  @include mobile {
    display: none !important;
  }
}

// ===== Classes utilitaires pour surfaces sombres et gradient header =====
.dark-surface-1 { background-color: $color-surface-dark-1; }
.dark-surface-2 { background-color: $color-surface-dark-2; }
.dark-surface-3 { background-color: $color-surface-dark-3; }
.dark-surface-glass { background-color: $color-surface-glass; backdrop-filter: blur(8px); }
.header-gradient { background: linear-gradient(135deg, $color-gradient-header-start 0%, $color-gradient-header-end 100%); }
.header-gradient-border { border-bottom:1px solid $color-surface-outline; }
.filter-card-dark { background-color: $color-surface-dark-2; border:1px solid $color-surface-outline; color: var(--color-text); }
.filter-card-dark h3 { color: $color-success; }
.filter-card-dark label { color: lighten($color-text,15%); }
.filter-card-dark .select, .filter-card-dark .input { background:$color-surface-dark-3; color: var(--color-text); border:1px solid $color-surface-outline; }
.filter-card-dark .select:focus, .filter-card-dark .input:focus { border-color:$color-primary; box-shadow:0 0 0 3px rgba($color-primary,0.25); }
.filter-card-dark button { color: var(--color-text); }
.filter-card-dark button.bg-white { background:$color-surface-dark-3; border-color:$color-surface-outline; }
.filter-card-dark button.bg-white:hover { background:$color-surface-dark-2; }

/* Variantes sombres pour panels, restaurant-card et update-panel */
.panel-dark { background:$color-surface-dark-1; border:1px solid $color-surface-outline; color: var(--color-text); border-radius:$border-radius-lg; }
.panel-dark-alt { background:$color-surface-dark-2; border:1px solid $color-surface-outline; color: var(--color-text); border-radius:$border-radius-lg; }
.panel-dark-gradient { background:linear-gradient(145deg,$color-surface-dark-1 0%,$color-surface-dark-3 100%); border:1px solid $color-surface-outline; color:var(--color-text); border-radius:$border-radius-lg; }
.restaurant-card--dark { background:$color-surface-dark-1; color:var(--color-text); border:1px solid $color-surface-outline; }
.restaurant-card--dark .restaurant-card__title { color: var(--color-text); }
.restaurant-card--dark .restaurant-card__icon-btn:hover { background:$color-surface-dark-2; }
.restaurant-card--dark .text-muted { color: rgba(255,255,255,0.7); }
.update-panel--dark { background:$color-surface-dark-2; color:var(--color-text); border:1px solid $color-surface-outline; }
.update-panel--dark .update-panel__stats { background:rgba($color-success,0.15); border-color:$color-success; }
.update-panel--dark .update-panel__error { background:rgba($color-error,0.15); border-color:$color-error; }
.update-panel--dark .update-panel__small-btn { background:$color-surface-dark-3; border-color:$color-surface-outline; color:var(--color-text); }
.update-panel--dark .update-panel__small-btn:hover { background:$color-surface-dark-2; }
.btn-sync--dark { @include button-success; background:$color-success; color:$color-secondary; }

/* Améliorations contraste dark */
.restaurant-card--dark .restaurant-card__address { color: rgba(255,255,255,0.85); }
.update-panel--dark .update-panel__info { color: rgba(255,255,255,0.85); }
.update-panel--dark .update-panel__stats h4 { color: var(--color-text); }
.update-panel--dark .update-panel__stats .space-y-1 p { color: rgba(255,255,255,0.9); }
.update-panel--dark .update-panel__error h4, .update-panel--dark .update-panel__error p { color: #ffd7d7; }

// === Classes texte sémantiques ===
.text-primary { color: $color-primary !important; }
.text-secondary { color: $color-secondary !important; }
.text-success { color: $color-success !important; }
.text-error { color: $color-error !important; }
.text-warning { color: $color-warning !important; }
.text-info { color: $color-info !important; }
.text-inverse { color: var(--color-text) !important; }
.text-muted-light { color: rgba(255,255,255,0.7) !important; }
.text-surface { color: $color-surface-text !important; }

/* Pills pour filtres */
.pill { border:1px solid $color-surface-outline; background:$color-surface-dark-3; color:var(--color-text); border-radius:$border-radius-lg; padding:.5rem .75rem; font-size:$font-size-sm; transition: all $transition-fast; }
.pill:hover { border-color:$color-primary; }
.pill--active { background:$color-primary; border-color:$color-primary; color:#fff; }
